<!DOCTYPE html>
<html>
<head>
  <title>My Notes</title>
</head>
<body>

  <nav style="background-color: #2c3e50; padding: 12px;">
  <a href="index.html" style="color: #ecf0f1; margin-right: 20px; text-decoration: none; font-weight: bold;">Add Notes</a>
  <a href="view-notes.html" style="color: #ecf0f1; margin-right: 20px; text-decoration: none; font-weight: bold;">View Notes</a>
  <a href="loan-amortization.html" style="color: #ecf0f1; text-decoration: none; font-weight: bold;">Loan Amortization</a>
  </nav>
  <h1>Add a Note</h1>
  <form id="note-form">
    Heading: <input type="text" id="heading"><br><br>
    Description: <textarea id="description"></textarea><br><br>
    <button type="submit">Save Note</button>
  </form>
  <p id="message"></p>
<h2>Add Bike History</h2>

<form id="add-bike-history-form">
  <label for="date_changed">Date Changed:</label><br>
  <input type="date" id="date_changed" name="date_changed" required><br><br>

  <label for="amount">Amount (₹):</label><br>
  <input type="number" id="amount" name="amount" required><br><br>

  <label for="at_distance">At Distance (km):</label><br>
  <input type="number" id="at_distance" name="at_distance" required><br><br>

  <button type="submit">Add Bike Record</button>
</form>

<p id="bike-history-message"></p>

<hr>

<h2>Bike History Records</h2>
<table border="1" id="bike-history-table">
  <thead>
    <tr>
      <th>Date Changed</th>
      <th>Amount (₹)</th>
      <th>At Distance (km)</th>
    </tr>
  </thead>
  <tbody>
    <!-- Bike history entries will be inserted here dynamically -->
  </tbody>
</table>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://wzgchcvyzskespcfrjvi.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6Z2NoY3Z5enNrZXNwY2ZyanZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE4NjQwNDEsImV4cCI6MjA1NzQ0MDA0MX0.UuAgu4quD9Vg80tOUSkfGJ4doOT0CUFEUeoHsiyeNZQ'
    const supabase = createClient(supabaseUrl, supabaseKey)

    document.getElementById('note-form').addEventListener('submit', async function(e) {
      e.preventDefault()

      const heading = document.getElementById('heading').value
      const description = document.getElementById('description').value

      const { error } = await supabase.from('notes').insert([{ heading, description }])

      document.getElementById('message').textContent = error ? error.message : 'Note saved successfully!'
    })
  </script>
</body>
</html>


<script>
  // Function to load bike history records
  function loadBikeHistory() {
    fetch('/api/get-bike-history')  // <-- Adjust this endpoint in your backend
      .then(response => response.json())
      .then(data => {
        const tableBody = document.querySelector("#bike-history-table tbody");
        tableBody.innerHTML = ""; // Clear existing rows

        data.forEach(record => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${record.date_changed}</td>
            <td>${record.amount}</td>
            <td>${record.at_distance}</td>
          `;
          tableBody.appendChild(row);
        });
      })
      .catch(error => {
        console.error("Error loading bike history:", error);
      });
  }

  // Function to handle form submission
  document.getElementById("add-bike-history-form").addEventListener("submit", function(event) {
    event.preventDefault();

    const dateChanged = document.getElementById("date_changed").value;
    const amount = document.getElementById("amount").value;
    const atDistance = document.getElementById("at_distance").value;

    const payload = {
      date_changed: dateChanged,
      amount: parseFloat(amount),
      at_distance: parseInt(atDistance)
    };

    fetch('/api/add-bike-history', {  // <-- your BE endpoint
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById("bike-history-message").textContent = "Bike record added successfully!";
        document.getElementById("add-bike-history-form").reset();
        loadBikeHistory(); // Refresh the table after successful addition
      } else {
        document.getElementById("bike-history-message").textContent = "Failed to add bike record.";
      }
    })
    .catch(error => {
      console.error("Error adding bike history:", error);
      document.getElementById("bike-history-message").textContent = "Error occurred while adding bike record.";
    });
  });

  // Load bike history initially on page load
  window.onload = loadBikeHistory;
</script>

